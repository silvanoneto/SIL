// LIS Example: Construção de State
// Demonstra: vacuum, neutral, set_layer e construção manual
// Documentação: Seções 1.3, 6.8, 8.3

// =========================================
// Padrão: Singleton State
// =========================================

// Estado com apenas uma camada ativa
fn create_singleton(layer_idx: Int, value: ByteSil) -> State {
    let s = state_vacuum();
    return state_set_layer(s, layer_idx, value);
}

// =========================================
// Padrão: Uniform State
// =========================================

// Estado com todas as camadas iguais
fn create_uniform(value: ByteSil) -> State {
    let s = state_vacuum();
    let s = state_set_layer(s, 0, value);
    let s = state_set_layer(s, 1, value);
    let s = state_set_layer(s, 2, value);
    let s = state_set_layer(s, 3, value);
    let s = state_set_layer(s, 4, value);
    let s = state_set_layer(s, 5, value);
    let s = state_set_layer(s, 6, value);
    let s = state_set_layer(s, 7, value);
    let s = state_set_layer(s, 8, value);
    let s = state_set_layer(s, 9, value);
    let s = state_set_layer(s, 10, value);
    let s = state_set_layer(s, 11, value);
    let s = state_set_layer(s, 12, value);
    let s = state_set_layer(s, 13, value);
    let s = state_set_layer(s, 14, value);
    let s = state_set_layer(s, 15, value);
    return s;
}

fn main() {
    print_string("=== State Construction ===");

    // =========================================
    // Estrutura do State
    // =========================================
    // State: Container de 16 camadas (L0-LF)
    // Cada camada contém um ByteSil
    //
    // L0-L3:  Percepção (input sensorial)
    // L4:     Fronteira de Percepção
    // L5-L7:  Processamento (computação)
    // L8-LA:  Interação (comunicação)
    // LB-LC:  Emergência (swarm behavior)
    // LD-LF:  Meta (reflexão/checkpoint)

    // =========================================
    // state_vacuum() - Estado Zerado
    // =========================================
    print_string("--- state_vacuum() ---");

    // Todas as 16 camadas contêm bytesil_null()
    let vacuum = state_vacuum();

    print_string("Vacuum state created");
    print_string("Layer 0 magnitude (should be ~0):");
    print_float(bytesil_magnitude(state_get_layer(vacuum, 0)));

    let is_vac = state_is_vacuum(vacuum);
    if is_vac {
        print_string("state_is_vacuum: true");
    }

    // =========================================
    // state_neutral() - Estado Neutro
    // =========================================
    print_string("--- state_neutral() ---");

    // Camadas com valores padrão (neutro)
    let neutral = state_neutral();

    print_string("Neutral state created");
    print_string("Layer 0 magnitude:");
    print_float(bytesil_magnitude(state_get_layer(neutral, 0)));

    let is_neut = state_is_neutral(neutral);
    if is_neut {
        print_string("state_is_neutral: true");
    }

    // =========================================
    // state_maximum() - Estado Máximo
    // =========================================
    print_string("--- state_maximum() ---");

    let maximum = state_maximum();

    print_string("Maximum state created");
    print_string("Layer 0 magnitude:");
    print_float(bytesil_magnitude(state_get_layer(maximum, 0)));

    // =========================================
    // state_set_layer() - Definir Camada
    // =========================================
    print_string("--- state_set_layer() ---");

    // Criar estado e definir camadas específicas
    let s = state_vacuum();

    let val1 = bytesil_new(8, 0);
    let val2 = bytesil_new(10, 4);
    let val3 = bytesil_from_complex(3.0, 4.0);

    // Definir camadas de percepção
    let s = state_set_layer(s, 0, val1);  // L0
    let s = state_set_layer(s, 1, val2);  // L1
    let s = state_set_layer(s, 2, val3);  // L2

    print_string("Set layers 0, 1, 2");
    print_string("Layer 0 magnitude:");
    print_float(bytesil_magnitude(state_get_layer(s, 0)));
    print_string("Layer 1 magnitude:");
    print_float(bytesil_magnitude(state_get_layer(s, 1)));
    print_string("Layer 2 magnitude:");
    print_float(bytesil_magnitude(state_get_layer(s, 2)));

    // =========================================
    // Construção Manual Completa
    // =========================================
    print_string("--- Full Manual Construction ---");

    let full = state_vacuum();
    let default_val = bytesil_new(5, 0);

    // Definir todas as 16 camadas
    let full = state_set_layer(full, 0, default_val);
    let full = state_set_layer(full, 1, default_val);
    let full = state_set_layer(full, 2, default_val);
    let full = state_set_layer(full, 3, default_val);
    let full = state_set_layer(full, 4, default_val);
    let full = state_set_layer(full, 5, default_val);
    let full = state_set_layer(full, 6, default_val);
    let full = state_set_layer(full, 7, default_val);
    let full = state_set_layer(full, 8, default_val);
    let full = state_set_layer(full, 9, default_val);
    let full = state_set_layer(full, 10, default_val);
    let full = state_set_layer(full, 11, default_val);
    let full = state_set_layer(full, 12, default_val);
    let full = state_set_layer(full, 13, default_val);
    let full = state_set_layer(full, 14, default_val);
    let full = state_set_layer(full, 15, default_val);

    print_string("Full state constructed with 16 layers");

    let active = state_count_active_layers(full);
    print_string("Active layers:");
    print_int(active);

    // =========================================
    // Padrão: Singleton State
    // =========================================
    print_string("--- Singleton Pattern ---");

    let singleton = create_singleton(5, bytesil_new(15, 0));
    print_string("Singleton at layer 5:");
    print_float(bytesil_magnitude(state_get_layer(singleton, 5)));

    // =========================================
    // Padrão: Uniform State
    // =========================================
    print_string("--- Uniform Pattern ---");

    let uniform = create_uniform(bytesil_one());
    print_string("Uniform state created with all layers = 1");
}
