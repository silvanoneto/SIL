// LIS Example: Operações HTTP
// Demonstra: http_get, http_post, http_put, http_patch, http_delete
// Documentação: Seção 8.8

// =========================================
// Padrões de Uso
// =========================================

// Wrapper para API
fn api_base_url() -> String {
    return "https://api.example.com";
}

fn build_url(endpoint: String) -> String {
    return string_concat(api_base_url(), endpoint);
}

// Exemplo de construção de JSON
fn build_json_user(name: String, age: Int) -> String {
    let json = "{\"name\": \"";
    let json = string_concat(json, name);
    let json = string_concat(json, "\"}");
    return json;
}

fn main() {
    print_string("=== HTTP Operations ===");

    // =========================================
    // Nota sobre HTTP
    // =========================================
    print_string("--- About HTTP Functions ---");
    print_string("HTTP functions allow LIS to make web requests.");
    print_string("All functions return String with response body.");
    print_string("These are intrinsic functions for network I/O.");

    // =========================================
    // HTTP GET (http_get)
    // =========================================
    print_string("--- http_get(url) ---");
    print_string("GET retrieves data from a URL.");
    print_string("Syntax: let response = http_get(url);");

    // Exemplo conceitual (não executa sem rede)
    // let data = http_get("https://api.example.com/data");
    // print_string(data);

    print_string("Example:");
    print_string("  let users = http_get(\"https://api.example.com/users\");");

    // =========================================
    // HTTP POST (http_post)
    // =========================================
    print_string("--- http_post(url, body) ---");
    print_string("POST sends data to create a resource.");
    print_string("Syntax: let response = http_post(url, json_body);");

    print_string("Example:");
    print_string("  let result = http_post(");
    print_string("    \"https://api.example.com/users\",");
    print_string("    \"{\\\"name\\\": \\\"Alice\\\"}\"");
    print_string("  );");

    // =========================================
    // HTTP PUT (http_put)
    // =========================================
    print_string("--- http_put(url, body) ---");
    print_string("PUT replaces an entire resource.");
    print_string("Syntax: let response = http_put(url, json_body);");

    print_string("Example:");
    print_string("  let result = http_put(");
    print_string("    \"https://api.example.com/users/1\",");
    print_string("    \"{\\\"name\\\": \\\"Bob\\\", \\\"age\\\": 30}\"");
    print_string("  );");

    // =========================================
    // HTTP PATCH (http_patch)
    // =========================================
    print_string("--- http_patch(url, body) ---");
    print_string("PATCH partially updates a resource.");
    print_string("Syntax: let response = http_patch(url, json_body);");

    print_string("Example:");
    print_string("  let result = http_patch(");
    print_string("    \"https://api.example.com/users/1\",");
    print_string("    \"{\\\"age\\\": 31}\"");
    print_string("  );");

    // =========================================
    // HTTP DELETE (http_delete)
    // =========================================
    print_string("--- http_delete(url) ---");
    print_string("DELETE removes a resource.");
    print_string("Syntax: let response = http_delete(url);");

    print_string("Example:");
    print_string("  let result = http_delete(\"https://api.example.com/users/1\");");

    // =========================================
    // Padrões de Uso
    // =========================================
    print_string("--- Usage Patterns ---");

    print_string("API wrapper pattern:");
    print_string("  fn get_users() -> String {");
    print_string("    return http_get(build_url(\"/users\"));");
    print_string("  }");

    // Retry pattern
    print_string("Retry pattern:");
    print_string("  fn fetch_with_retry(url: String, max_tries: Int) -> String {");
    print_string("    let tries = 0;");
    print_string("    loop {");
    print_string("      let response = http_get(url);");
    print_string("      // Check response, retry if needed");
    print_string("      tries = tries + 1;");
    print_string("      if tries >= max_tries { break; }");
    print_string("    }");
    print_string("    return response;");
    print_string("  }");

    // =========================================
    // Formato de Dados
    // =========================================
    print_string("--- Data Formats ---");
    print_string("HTTP bodies are typically JSON strings.");
    print_string("LIS treats all responses as String.");
    print_string("Parse JSON response as needed in your code.");

    let json_body = build_json_user("Alice", 25);
    print_string("Built JSON body:");
    print_string(json_body);

    // =========================================
    // Error Handling
    // =========================================
    print_string("--- Error Handling ---");
    print_string("HTTP functions may fail on network errors.");
    print_string("Check response for error indicators.");
    print_string("Common patterns:");
    print_string("  - Check for empty response");
    print_string("  - Check for error status in response");
    print_string("  - Use try/catch if available");

    // =========================================
    // Use Cases
    // =========================================
    print_string("--- Common Use Cases ---");
    print_string("1. REST API integration");
    print_string("2. Webhook notifications");
    print_string("3. External service calls");
    print_string("4. Data fetching for ML pipelines");
    print_string("5. Health checks and monitoring");

    print_string("=== HTTP Operations Demo Complete ===");
}
