// LIS Example: Precedência de Operadores
// Demonstra: Ordem de avaliação de operadores
// Documentação: Seção 6.1

fn main() {
    print_string("=== Operator Precedence ===");

    // =========================================
    // Tabela de Precedência (baixo → alto)
    // =========================================
    // 1.  |>           (pipe)           - mais baixa
    // 2.  ||           (logical or)
    // 3.  &&           (logical and)
    // 4.  == !=        (equality)
    // 5.  < <= > >=    (comparison)
    // 6.  + -          (additive)
    // 7.  * / ^        (multiplicative, xor)
    // 8.  **           (power)          - associativo à direita
    // 9.  - ! ~ |x|    (unary)
    // 10. Primário     (literals, vars) - mais alta

    // =========================================
    // Aritméticos: * / antes de + -
    // =========================================
    print_string("--- Arithmetic Precedence ---");

    let r1 = 2 + 3 * 4;      // 2 + (3 * 4) = 14, não (2 + 3) * 4 = 20
    print_string("2 + 3 * 4 =");
    print_int(r1);

    let r2 = 10 - 6 / 2;     // 10 - (6 / 2) = 7
    print_string("10 - 6 / 2 =");
    print_int(r2);

    let r3 = (2 + 3) * 4;    // Parênteses forçam ordem
    print_string("(2 + 3) * 4 =");
    print_int(r3);

    // =========================================
    // Potência: maior que multiplicação
    // =========================================
    print_string("--- Power Precedence ---");

    let r4 = 2 * 3 ** 2;     // 2 * (3^2) = 18, não (2 * 3)^2 = 36
    print_string("2 * 3 ** 2 =");
    print_int(r4);

    // Potência é associativa à direita
    let r5 = 2 ** 3 ** 2;    // 2 ^ (3 ^ 2) = 2^9 = 512
    print_string("2 ** 3 ** 2 =");
    print_int(r5);

    // =========================================
    // Comparação antes de lógicos
    // =========================================
    print_string("--- Comparison vs Logical ---");

    let a = 5;
    let b = 10;
    let c = 15;

    // a < b && b < c é avaliado como (a < b) && (b < c)
    if a < b && b < c {
        print_string("5 < 10 && 10 < 15: parsed as (5 < 10) && (10 < 15)");
    }

    // =========================================
    // AND (&&) antes de OR (||)
    // =========================================
    print_string("--- AND vs OR ---");

    let t = true;
    let f = false;

    // true || false && false = true || (false && false) = true
    if t || f && f {
        print_string("true || false && false = true");
    }

    // (true || false) && false = true && false = false
    if (t || f) && f {
        print_string("(true || false) && false = true");
    } else {
        print_string("(true || false) && false = false");
    }

    // =========================================
    // XOR (^): mesma precedência que * /
    // =========================================
    print_string("--- XOR Precedence ---");

    let x = 12;  // 1100
    let y = 10;  // 1010

    // XOR é avaliado junto com * /
    let r6 = x ^ y;
    print_string("12 ^ 10 =");
    print_int(r6);  // 6 (0110)

    // Com parênteses explícitos
    let r7 = (x ^ y) + 1;
    print_string("(12 ^ 10) + 1 =");
    print_int(r7);  // 7

    // =========================================
    // Unários: mais alta precedência
    // =========================================
    print_string("--- Unary Precedence ---");

    let r8 = 0 - 3 ** 2;     // 0 - (3^2) = -9
    print_string("0 - 3 ** 2 =");
    print_int(r8);

    // =========================================
    // Pipeline: menor precedência
    // =========================================
    print_string("--- Pipeline Precedence ---");

    // Pipeline tem a menor precedência
    // x |> f |> g é (x |> f) |> g (associativo à esquerda)

    print_string("Pipeline has lowest precedence");
    print_string("Always evaluated left-to-right");

    // =========================================
    // Recomendação: Use parênteses
    // =========================================
    print_string("--- Recommendation ---");
    print_string("When in doubt, use parentheses for clarity!");
}
