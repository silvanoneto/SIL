// LIS Example: Tipo State
// Demonstra: State e suas 16 camadas (L0-LF)
// Documentação: Seções 1.3, 4.1

fn main() {
    // =========================================
    // State - Container de 16 Camadas
    // =========================================
    // Cada camada contém um ByteSil
    //
    // Organização das camadas:
    // L0-L3    Percepção (input sensorial)
    // L4       Fronteira de Percepção
    // L5-L7    Processamento (computação)
    // L8-LA    Interação (comunicação)
    // LB-LC    Emergência (comportamento de swarm)
    // LD-LF    Meta (reflexão/checkpoint)

    print_string("=== State Construction ===");

    // Criar estado vacuum (todas as camadas zeradas)
    let vacuum: State = state_vacuum();
    print_string("Created vacuum state");

    // Criar estado neutral (valores padrão)
    let neutral: State = state_neutral();
    print_string("Created neutral state");

    // =========================================
    // Acesso às Camadas
    // =========================================

    print_string("=== Layer Access ===");

    // Criar valor para inserir
    let value = bytesil_new(8, 4);

    // Modificar camadas específicas
    let s = state_vacuum();
    let s = state_set_layer(s, 0, value);   // L0 - Percepção
    let s = state_set_layer(s, 5, value);   // L5 - Processamento
    let s = state_set_layer(s, 8, value);   // L8 - Interação

    // Ler camadas
    let layer0 = state_get_layer(s, 0);
    let layer5 = state_get_layer(s, 5);
    let layer8 = state_get_layer(s, 8);

    print_string("Layer 0 magnitude:");
    print_float(bytesil_magnitude(layer0));

    print_string("Layer 5 magnitude:");
    print_float(bytesil_magnitude(layer5));

    // =========================================
    // Referências de Camada (L0-LF)
    // =========================================

    print_string("=== Layer References ===");

    // Acesso via notação .L<n>
    let s2 = state_neutral();

    // Camadas de Percepção (L0-L3)
    let perception0 = s2.L0;
    let perception1 = s2.L1;
    let perception2 = s2.L2;
    let perception3 = s2.L3;

    // Fronteira (L4)
    let boundary = s2.L4;

    // Camadas de Processamento (L5-L7)
    let process5 = s2.L5;
    let process6 = s2.L6;
    let process7 = s2.L7;

    // Camadas de Interação (L8-LA)
    let interact8 = s2.L8;
    let interact9 = s2.L9;
    let interactA = s2.LA;

    // Camadas de Emergência (LB-LC)
    let emergeB = s2.LB;
    let emergeC = s2.LC;

    // Camadas Meta (LD-LF)
    let metaD = s2.LD;
    let metaE = s2.LE;
    let metaF = s2.LF;

    print_string("All 16 layers accessed successfully");

    // =========================================
    // State Predicates
    // =========================================

    print_string("=== State Predicates ===");

    let is_vac = state_is_vacuum(vacuum);
    if is_vac {
        print_string("vacuum state is indeed vacuum");
    }

    let is_neut = state_is_neutral(neutral);
    if is_neut {
        print_string("neutral state is indeed neutral");
    }

    // Contagem de camadas ativas
    let active_count = state_count_active_layers(s);
    print_string("Active layers in modified state:");
    print_int(active_count);
}
