{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "SIL",
  "scopeName": "source.sil",
  "patterns": [
    { "include": "#comments" },
    { "include": "#directives" },
    { "include": "#labels" },
    { "include": "#instructions" },
    { "include": "#numbers" },
    { "include": "#strings" },
    { "include": "#registers" }
  ],
  "repository": {
    "comments": {
      "patterns": [
        {
          "name": "comment.line.semicolon.sil",
          "match": ";.*$"
        }
      ]
    },
    "directives": {
      "patterns": [
        {
          "name": "keyword.control.directive.section.sil",
          "match": "\\.(code|text|data)\\b"
        },
        {
          "name": "keyword.control.directive.mode.sil",
          "match": "\\.(mode)\\s+(SIL-(?:8|16|32|64|128))",
          "captures": {
            "1": { "name": "keyword.control.directive.sil" },
            "2": { "name": "support.type.mode.sil" }
          }
        },
        {
          "name": "keyword.control.directive.sil",
          "match": "\\.(global|globl|extern|align|byte|state|string)\\b"
        }
      ]
    },
    "labels": {
      "patterns": [
        {
          "name": "entity.name.function.label.sil",
          "match": "^\\s*([A-Za-z_][A-Za-z0-9_]*)\\s*:",
          "captures": {
            "1": { "name": "entity.name.function.label.sil" }
          }
        }
      ]
    },
    "instructions": {
      "patterns": [
        {
          "comment": "Control flow opcodes",
          "name": "keyword.control.flow.sil",
          "match": "\\b(NOP|HLT|RET|YIELD|JMP|JZ|JN|JC|JO|CALL|LOOP)\\b",
          "captures": {
            "1": { "name": "keyword.control.flow.sil" }
          }
        },
        {
          "comment": "Data movement opcodes",
          "name": "keyword.operator.data.sil",
          "match": "\\b(MOV|MOVI|LOAD|STORE|PUSH|POP|XCHG|LSTATE|SSTATE)\\b"
        },
        {
          "comment": "Arithmetic opcodes",
          "name": "keyword.operator.arithmetic.sil",
          "match": "\\b(MUL|DIV|POW|ROOT|INV|CONJ|ADD|SUB|MAG|PHASE|SCALE|ROTATE)\\b"
        },
        {
          "comment": "Layer opcodes",
          "name": "keyword.operator.layer.sil",
          "match": "\\b(XORL|ANDL|ORL|NOTL|SHIFTL|ROTATL|FOLD|SPREAD|GATHER)\\b"
        },
        {
          "comment": "Transform opcodes",
          "name": "keyword.operator.transform.sil",
          "match": "\\b(TRANS|PIPE|LERP|SLERP|GRAD|DESCENT|EMERGE|COLLAPSE)\\b"
        },
        {
          "comment": "Compatibility opcodes",
          "name": "keyword.operator.compat.sil",
          "match": "\\b(SETMODE|PROMOTE|DEMOTE|TRUNCATE|XORDEM|AVGDEM|MAXDEM|COMPAT)\\b"
        },
        {
          "comment": "System opcodes",
          "name": "keyword.operator.system.sil",
          "match": "\\b(IN|OUT|SENSE|ACT|SYNC|BROADCAST|RECEIVE|ENTANGLE)\\b"
        },
        {
          "comment": "Hint opcodes",
          "name": "keyword.other.hint.sil",
          "match": "\\b(HINT\\.CPU|HINT\\.GPU|HINT\\.NPU|HINT\\.ANY|BATCH|UNBATCH|PREFETCH|FENCE|SYSCALL)\\b"
        }
      ]
    },
    "registers": {
      "patterns": [
        {
          "comment": "General registers R0-R9",
          "name": "variable.language.register.sil",
          "match": "\\b[Rr]([0-9]|1[0-5]|[Aa-Ff])\\b"
        },
        {
          "comment": "Layer constants L0-LF",
          "name": "constant.language.layer.sil",
          "match": "\\b[Ll][0-9A-Fa-f]\\b"
        }
      ]
    },
    "numbers": {
      "patterns": [
        {
          "comment": "Hexadecimal numbers",
          "name": "constant.numeric.hex.sil",
          "match": "\\b0[xX][0-9A-Fa-f]+\\b"
        },
        {
          "comment": "Binary numbers",
          "name": "constant.numeric.binary.sil",
          "match": "\\b0[bB][01]+\\b"
        },
        {
          "comment": "Decimal numbers",
          "name": "constant.numeric.decimal.sil",
          "match": "\\b-?[0-9]+\\b"
        },
        {
          "comment": "Floating point",
          "name": "constant.numeric.float.sil",
          "match": "\\b-?[0-9]+\\.[0-9]+\\b"
        }
      ]
    },
    "strings": {
      "patterns": [
        {
          "name": "string.quoted.double.sil",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            {
              "name": "constant.character.escape.sil",
              "match": "\\\\."
            }
          ]
        }
      ]
    }
  }
}
